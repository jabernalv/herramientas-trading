<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Break-even</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center px-4 py-10">
  <div id="app" class="bg-white shadow-md rounded p-6 max-w-5xl w-full grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Columna principal -->
    <div class="md:col-span-2">
      <h1 class="text-2xl font-bold mb-6 text-center">Calculadora de Break-even</h1>

      <!-- Par -->
      <div class="mb-4 relative">
        <label class="block font-semibold mb-1">Par de divisas o activo</label>
        <span class="absolute left-3 top-10 text-gray-500">
          <i data-lucide="globe" class="w-4 h-4"></i>
        </span>
        <select v-model="pair" @focus="setAyuda('pair')" class="w-full pl-10 border border-gray-300 rounded p-2">
          <option disabled value="">-- Selecciona un par --</option>
          <option v-for="(info, key) in pipTable" :key="key" :value="key">{{ key }}</option>
        </select>
      </div>

      <!-- Inputs -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div class="relative">
          <label class="block font-semibold mb-1">Tamaño del lote</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="layers" class="w-4 h-4"></i>
          </span>
          <input v-model.number="lote" @focus="setAyuda('lote')" type="number" step="0.01"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>
        <div class="relative">
          <label class="block font-semibold mb-1">Spread (en pips)</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="move-horizontal" class="w-4 h-4"></i>
          </span>
          <input v-model.number="spread" @focus="setAyuda('spread')" type="number" step="0.01"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>
        <div class="relative">
          <label class="block font-semibold mb-1">Comisión (USD)</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="file-cash" class="w-4 h-4"></i>
          </span>
          <input v-model.number="comision" @focus="setAyuda('comision')" type="number" step="0.01"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>
      </div>

      <!-- Botón -->
      <div class="text-center mb-6">
        <button @click="calcularBreakEven"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 inline-flex items-center gap-2">
          <i data-lucide="calculator" class="w-4 h-4"></i>
          Calcular break-even
        </button>
      </div>

      <!-- Resultados -->
      <div v-if="resultado" class="text-sm bg-gray-100 border border-gray-300 p-4 rounded mb-6">
        <p><strong>Break-even en pips:</strong> {{ resultado.pips.toFixed(2) }}</p>
        <p><strong>Valor equivalente en USD:</strong> ${{ resultado.usd.toFixed(2) }}</p>
        <p class="mt-2">Para cubrir el costo operativo de esta operación, el precio debe moverse al menos <strong>{{ resultado.pips.toFixed(2) }} pips</strong> a tu favor, lo que representa <strong>${{ resultado.usd.toFixed(2) }}</strong> considerando spread y comisiones.</p>
      </div>
    </div>

    <!-- Ayuda contextual -->
    <div class="bg-gray-100 border border-gray-300 p-4 rounded text-sm leading-relaxed">
      <h2 class="font-bold text-lg mb-2">Ayuda contextual</h2>
      <p v-if="ayudaActiva">{{ ayudas[ayudaActiva] }}</p>
      <p v-else class="text-gray-500">Enfoca un campo para ver la explicación.</p>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          pair: '',
          lote: null,
          spread: null,
          comision: 0,
          ayudaActiva: '',
          resultado: null,
          pipTable: {
            EURUSD: { valorPip: 10 },
            GBPUSD: { valorPip: 10 },
            USDJPY: { valorPip: 9.13 },
            GBPJPY: { valorPip: 9.13 },
            AUDUSD: { valorPip: 10 },
            NZDUSD: { valorPip: 10 },
            USDCHF: { valorPip: 10 },
            USDCAD: { valorPip: 10 },
            XAUUSD: { valorPip: 1 },
            XAGUSD: { valorPip: 5 },
            XAUEUR: { valorPip: 1 },
            XAGEUR: { valorPip: 5 }
          },
          ayudas: {
            pair: 'Selecciona el par que vas a operar. El valor del pip por lote depende del activo: no es lo mismo operar EUR/USD que oro o plata.',
            lote: 'El tamaño del lote determina la exposición de tu operación. Más lote implica mayor impacto del spread y de cualquier comisión.',
            spread: 'El spread es la diferencia entre el precio de compra y el de venta. Es un costo implícito que el mercado cobra desde que abres la operación.',
            comision: 'Algunos brókers cobran una comisión fija por abrir y cerrar operaciones, adicional al spread. Aquí puedes incluirla si aplica.'
          }
        };
      },
      methods: {
        setAyuda(id) {
          this.ayudaActiva = id;
        },
        calcularBreakEven() {
          if (!this.pair || !this.lote || this.spread === null) {
            alert('Completa al menos par, lote y spread.');
            return;
          }
          const pipValue = this.pipTable[this.pair].valorPip;
          const costoTotal = (this.spread * pipValue * this.lote) + Number(this.comision);
          const pipsEquivalente = costoTotal / (pipValue * this.lote);
          this.resultado = {
            pips: pipsEquivalente,
            usd: costoTotal
          };
        }
      },
      mounted() {
        lucide.createIcons();
      },
      updated() {
        lucide.createIcons();
      }
    }).mount('#app');
  </script>
</body>
</html>
