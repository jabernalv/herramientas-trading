<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Simulador riesgo - recompensa</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center px-4 py-10">
  <div id="app" class="bg-white shadow-md rounded p-6 max-w-6xl w-full grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Miga de pan -->
    <div class="md:col-span-3 mb-4">
      <nav class="text-sm text-gray-600">
        <a href="index.html" class="text-blue-700 hover:underline inline-flex items-center gap-1">
          <i data-lucide="arrow-left" class="w-4 h-4"></i>
          Todas las herramientas
        </a>
        <span class="mx-2 text-gray-400">/</span>
        <span class="text-gray-800 font-medium">Simulador riesgo - recompensa</span>
      </nav>
    </div>
    <!-- Columna principal -->
    <div class="md:col-span-2">
      <h1 class="text-2xl font-bold mb-6 text-center">Simulador de riesgo - recompensa</h1>

      <!-- Selector de par -->
      <div class="mb-4 relative">
        <label class="block font-semibold mb-1">Par de divisas o activo</label>
        <span class="absolute left-3 top-10 text-gray-500">
          <i data-lucide="globe" class="w-4 h-4"></i>
        </span>
        <select v-model="pair" @focus="setAyuda('pair')" class="w-full pl-10 border border-gray-300 rounded p-2">
          <option disabled value="">-- Selecciona un par --</option>
          <option v-for="(info, key) in pipTable" :key="key" :value="key">{{ key }}</option>
        </select>
      </div>

      <!-- Inputs -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div class="relative">
          <label class="block font-semibold mb-1">Tamaño del lote</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="layers" class="w-4 h-4"></i>
          </span>
          <input v-model.number="lote" @focus="setAyuda('lote')" type="number" step="0.01"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>

        <div class="relative">
          <label class="block font-semibold mb-1">Precio de entrada</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="arrow-right-circle" class="w-4 h-4"></i>
          </span>
          <input v-model.number="entrada" @focus="setAyuda('entrada')" type="number" step="0.0001"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>

        <div class="relative">
          <label class="block font-semibold mb-1">Stop loss (precio)</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="arrow-down-circle" class="w-4 h-4"></i>
          </span>
          <input v-model.number="stop" @focus="setAyuda('stop')" type="number" step="0.0001"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>

        <div class="relative">
          <label class="block font-semibold mb-1">Take profit (precio)</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="arrow-up-circle" class="w-4 h-4"></i>
          </span>
          <input v-model.number="take" @focus="setAyuda('take')" type="number" step="0.0001"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>
      </div>

      <!-- Botón -->
      <div class="text-center mb-6">
        <button @click="simular"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 inline-flex items-center gap-2">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
          Simular riesgo - recompensa
        </button>
      </div>

      <!-- Resultados -->
      <div v-if="resultado" class="text-sm bg-gray-100 border border-gray-300 p-4 rounded mb-6">
        <p><strong>Riesgo:</strong> {{ resultado.pipsRiesgo.toFixed(2) }} pips → ${{ resultado.riesgoUSD.toFixed(2) }}</p>
        <p><strong>Recompensa:</strong> {{ resultado.pipsRecompensa.toFixed(2) }} pips → ${{ resultado.gananciaUSD.toFixed(2) }}</p>
        <p><strong>Relación R:R:</strong> {{ resultado.relacion.toFixed(2) }}</p>
        <p class="mt-2 font-medium text-blue-700">{{ resultado.recomendacion }}</p>
      </div>
    </div>

    <!-- Ayuda contextual -->
    <div class="bg-gray-100 border border-gray-300 p-4 rounded text-sm leading-relaxed">
      <h2 class="font-bold text-lg mb-2">Ayuda contextual</h2>
      <p v-if="ayudaActiva">{{ ayudas[ayudaActiva] }}</p>
      <p v-else class="text-gray-500">Enfoca un campo para ver la explicación.</p>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          pair: '',
          lote: null,
          entrada: null,
          stop: null,
          take: null,
          ayudaActiva: '',
          resultado: null,
          pipTable: {
            EURUSD: { valorPip: 10 },
            GBPUSD: { valorPip: 10 },
            USDJPY: { valorPip: 9.13 },
            GBPJPY: { valorPip: 9.13 },
            AUDUSD: { valorPip: 10 },
            NZDUSD: { valorPip: 10 },
            USDCHF: { valorPip: 10 },
            USDCAD: { valorPip: 10 },
            XAUUSD: { valorPip: 1 },
            XAGUSD: { valorPip: 5 },
            XAUEUR: { valorPip: 1 },
            XAGEUR: { valorPip: 5 }
          },
          ayudas: {
            pair: 'El par de divisas o activo que estás operando determina el valor del pip. Por ejemplo, un pip en EUR/USD vale $10 por lote estándar.',
            lote: 'Cuanto mayor el tamaño del lote, mayor será el impacto económico de los movimientos de precio. 1 lote estándar son 100.000 unidades (Forex).',
            entrada: 'El precio de entrada es el punto donde abrirías la operación. Desde aquí se calcula el riesgo y la recompensa.',
            stop: 'Es el precio al cual cerrarías la operación si sale mal. Determina cuántos pips estás dispuesto a arriesgar.',
            take: 'Es el precio al cual cerrarías la operación con ganancia. Define tu objetivo y se usa para calcular la recompensa esperada.'
          }
        };
      },
      methods: {
        setAyuda(id) {
          this.ayudaActiva = id;
        },
        simular() {
          if (!this.pair || !this.lote || !this.entrada || !this.stop || !this.take) {
            alert('Por favor completa todos los campos.');
            return;
          }

          const pipValue = this.pipTable[this.pair].valorPip;
          const pipsRiesgo = Math.abs(this.entrada - this.stop) / 0.0001;
          const pipsRecompensa = Math.abs(this.take - this.entrada) / 0.0001;

          const riesgoUSD = pipsRiesgo * pipValue * this.lote;
          const gananciaUSD = pipsRecompensa * pipValue * this.lote;

          const relacion = gananciaUSD / riesgoUSD;

          let recomendacion = '';
          if (relacion < 1) recomendacion = '❌ Riesgo no justificado: estás arriesgando más de lo que puedes ganar.';
          else if (relacion >= 1 && relacion < 2) recomendacion = '⚠️ Riesgo equilibrado: asegúrate de que esta operación tenga alta probabilidad.';
          else recomendacion = '✅ Excelente relación: tu recompensa supera ampliamente el riesgo asumido.';

          this.resultado = {
            pipsRiesgo,
            pipsRecompensa,
            riesgoUSD,
            gananciaUSD,
            relacion,
            recomendacion
          };
        }
      },
      mounted() {
        lucide.createIcons();
      },
      updated() {
        lucide.createIcons();
      }
    }).mount('#app');
  </script>
</body>
</html>
