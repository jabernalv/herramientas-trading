<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Calculadora de ganancia en trading</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Importar componentes -->
    <script src="components/NavHeader.js"></script>
    <script src="components/FooterComponent.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div id="app" class="pb-16">
      <!-- Usar componente nav -->
      <nav-header></nav-header>

      <!-- Espaciador para compensar el nav fijo -->
      <div class="h-16"></div>

      <!-- Sistema de notificaciones -->
      <div v-if="notification" class="fixed top-20 right-4 z-50 max-w-sm">
        <div
          :class="{
          'p-4 rounded-lg shadow-lg border flex items-start gap-3 transition-all duration-300': true,
          'bg-red-50 border-red-300 text-red-800': notification.type === 'error',
          'bg-yellow-50 border-yellow-300 text-yellow-800': notification.type === 'warning',
          'bg-green-50 border-green-300 text-green-800': notification.type === 'success'
        }"
        >
          <div class="flex-shrink-0 mt-0.5">
            <i
              v-if="notification.type === 'error'"
              data-lucide="alert-circle"
              class="w-5 h-5"
            ></i>
            <i
              v-if="notification.type === 'warning'"
              data-lucide="alert-triangle"
              class="w-5 h-5"
            ></i>
            <i
              v-if="notification.type === 'success'"
              data-lucide="check-circle"
              class="w-5 h-5"
            ></i>
          </div>
          <div>
            <h3 class="font-semibold">{{ notification.title }}</h3>
            <p class="text-sm">{{ notification.message }}</p>
          </div>
        </div>
      </div>

      <div class="flex items-center justify-center px-4 py-8">
        <div
          class="bg-white shadow-md rounded p-6 max-w-7xl w-full grid grid-cols-1 md:grid-cols-3 gap-6"
        >
          <!-- Columna principal -->
          <div class="md:col-span-2">
            <h1 class="text-2xl font-bold mb-6 text-center">
              Calculadora de ganancia en trading
            </h1>

            <!-- Selector de par -->
            <div class="mb-4 relative">
              <label class="block font-semibold mb-1"
                >Par de divisas o activo</label
              >
              <span class="absolute left-3 top-10 text-gray-500">
                <i data-lucide="globe" class="w-4 h-4"></i>
              </span>
              <select
                v-model="pair"
                @focus="setAyuda('pair')"
                @change="updateInputSteps"
                class="w-full pl-10 border border-gray-300 rounded p-2"
              >
                <option disabled value="">-- Selecciona un par --</option>
                <option v-for="(info, key) in pipTable" :key="key" :value="key">
                  {{ key }}
                </option>
              </select>
            </div>

            <!-- Tipo de operación -->
            <div class="mb-4">
              <label class="block font-semibold mb-1">Tipo de operación</label>
              <select
                v-model="tipoOperacion"
                @focus="setAyuda('tipoOperacion')"
                class="w-full border border-gray-300 rounded p-2"
              >
                <option value="compra">Compra (long)</option>
                <option value="venta">Venta (short)</option>
              </select>
            </div>

            <!-- Entradas -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              <div class="relative">
                <label class="block font-semibold mb-1"
                  >Precio de entrada</label
                >
                <span class="absolute left-3 top-10 text-gray-500">
                  <i data-lucide="trending-up" class="w-4 h-4"></i>
                </span>
                <input
                  v-model.number="precioEntrada"
                  @focus="setAyuda('precioEntrada')"
                  type="number"
                  :step="getPipSize()"
                  class="w-full text-right pl-10 border border-gray-300 rounded p-2"
                />
              </div>
              <div class="relative">
                <label class="block font-semibold mb-1">Precio de salida</label>
                <span class="absolute left-3 top-10 text-gray-500">
                  <i data-lucide="trending-down" class="w-4 h-4"></i>
                </span>
                <input
                  v-model.number="precioSalida"
                  @focus="setAyuda('precioSalida')"
                  type="number"
                  :step="getPipSize()"
                  class="w-full text-right pl-10 border border-gray-300 rounded p-2"
                />
              </div>
              <div class="relative">
                <label class="block font-semibold mb-1">Tamaño del lote</label>
                <span class="absolute left-3 top-10 text-gray-500">
                  <i data-lucide="layers" class="w-4 h-4"></i>
                </span>
                <input
                  v-model.number="lote"
                  @focus="setAyuda('lote')"
                  type="number"
                  step="0.01"
                  class="w-full text-right pl-10 border border-gray-300 rounded p-2"
                />
              </div>
              <div class="relative">
                <label class="block font-semibold mb-1">Apalancamiento</label>
                <span class="absolute left-3 top-10 text-gray-500">
                  <i data-lucide="percent" class="w-4 h-4"></i>
                </span>
                <input
                  v-model.number="apalancamiento"
                  @focus="setAyuda('apalancamiento')"
                  type="number"
                  step="1"
                  class="w-full text-right pl-10 border border-gray-300 rounded p-2"
                />
              </div>
            </div>

            <!-- Botón -->
            <div class="text-center mb-6">
              <button
                @click="handleClick"
                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 inline-flex items-center gap-2"
              >
                <i data-lucide="calculator" class="w-4 h-4"></i>
                Calcular ganancia
              </button>
            </div>

            <!-- Resultados -->
            <div
              v-if="resultado"
              class="text-sm bg-gray-100 border border-gray-300 p-4 rounded mb-6"
            >
              <p>
                <strong>Diferencia:</strong> {{
                resultado.diferenciaPips.toFixed(2) }} pips
              </p>
              <p>
                <strong>Ganancia / pérdida:</strong> ${{
                resultado.ganancia.toFixed(2) }}
              </p>
              <p>
                <strong>Margen requerido:</strong> ${{
                resultado.margen.toFixed(2) }}
              </p>
              <p>
                <strong>Rentabilidad sobre el margen:</strong> {{
                resultado.rentabilidad.toFixed(2) }}%
              </p>
              <p class="mt-3">
                Con este apalancamiento, esta operación requeriría un margen de
                <strong>${{ resultado.margen.toFixed(2) }}</strong>, y habría
                generado una ganancia de
                <strong>${{ resultado.ganancia.toFixed(2) }}</strong>, lo que
                equivale al
                <strong>{{ resultado.rentabilidad.toFixed(2) }}%</strong> sobre
                el capital inmovilizado.
              </p>
            </div>

            <!-- Tabla de valores pip por par -->
            <div>
              <h2 class="text-lg font-bold mb-2">
                Tabla de valores pip por lote
              </h2>
              <table class="w-full text-sm border border-gray-300">
                <thead class="bg-gray-200 text-gray-800">
                  <tr>
                    <th class="p-2 text-left">Par</th>
                    <th class="p-2 text-left">Valor pip por lote</th>
                    <th class="p-2 text-left">Unidades por lote</th>
                    <th class="p-2 text-left">Decimales</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    v-for="(info, key) in pipTable"
                    :key="key"
                    :class="{'bg-blue-100': pair === key}"
                  >
                    <td class="p-2">{{ key }}</td>
                    <td class="p-2">${{ info.valorPip.toFixed(2) }}</td>
                    <td class="p-2">{{ info.unidades.toLocaleString() }}</td>
                    <td class="p-2">{{ info.decimales }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Ayuda contextual -->
          <div
            class="bg-gray-100 border border-gray-300 p-4 rounded text-sm leading-relaxed"
          >
            <h2 class="font-bold text-lg mb-2">Ayuda contextual</h2>
            <p v-if="ayudaActiva">{{ ayudas[ayudaActiva] }}</p>
            <p v-else class="text-gray-500">
              Pasa el cursor o enfoca un campo para ver la explicación.
            </p>
          </div>
        </div>
      </div>

      <!-- Usar componente footer -->
      <footer-component></footer-component>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        components: {
          "nav-header": NavHeader,
          "footer-component": FooterComponent,
        },
        data() {
          return {
            pair: "",
            tipoOperacion: "compra",
            precioEntrada: null,
            precioSalida: null,
            lote: null,
            apalancamiento: null,
            ayudaActiva: "",
            resultado: null,
            notification: null,
            pipTable: {
              EURUSD: { valorPip: 10, unidades: 100000, decimales: 4 },
              GBPUSD: { valorPip: 10, unidades: 100000, decimales: 4 },
              USDJPY: { valorPip: 9.13, unidades: 100000, decimales: 2 },
              GBPJPY: { valorPip: 9.13, unidades: 100000, decimales: 2 },
              AUDUSD: { valorPip: 10, unidades: 100000, decimales: 4 },
              NZDUSD: { valorPip: 10, unidades: 100000, decimales: 4 },
              USDCHF: { valorPip: 10, unidades: 100000, decimales: 4 },
              USDCAD: { valorPip: 10, unidades: 100000, decimales: 4 },
              XAUUSD: { valorPip: 1, unidades: 100, decimales: 2 },
              XAGUSD: { valorPip: 5, unidades: 5000, decimales: 3 },
              XAUEUR: { valorPip: 1, unidades: 100, decimales: 2 },
              XAGEUR: { valorPip: 5, unidades: 5000, decimales: 3 },
            },
            rangosPrecio: {
              EURUSD: { min: 0.5, max: 2 },
              GBPUSD: { min: 0.5, max: 2 },
              USDJPY: { min: 50, max: 200 },
              GBPJPY: { min: 50, max: 200 },
              AUDUSD: { min: 0.5, max: 1.5 },
              NZDUSD: { min: 0.5, max: 1.5 },
              USDCHF: { min: 0.5, max: 2 },
              USDCAD: { min: 0.5, max: 2 },
              XAUUSD: { min: 1000, max: 3000 },
              XAGUSD: { min: 10, max: 50 },
              XAUEUR: { min: 1000, max: 3000 },
              XAGEUR: { min: 10, max: 50 },
            },
            ayudas: {
              pair: "En trading, el par seleccionado determina qué instrumento estás operando. El valor del pip y el tamaño del contrato dependen del activo. En metales como XAU/USD y XAG/USD, los lotes son más pequeños en unidades, pero el impacto económico puede ser alto. Elegir bien el par es clave para controlar el riesgo.",
              tipoOperacion:
                'Una operación de tipo "compra" (long) gana si el precio sube; una "venta" (short) gana si el precio baja. El tipo de operación determina cómo se interpreta la diferencia entre precio de entrada y de salida.',
              precioEntrada:
                "Es el punto inicial desde el cual calculas la ganancia o pérdida. Un cambio pequeño puede representar muchos dólares si el lote o apalancamiento es grande.",
              precioSalida:
                "Es el punto final de la operación. Comparado con el precio de entrada, determina la diferencia en pips y, por tanto, el resultado financiero.",
              lote: "El tamaño del lote escala directamente la ganancia o pérdida. En Forex 1 lote son 100.000 unidades; en oro 100 onzas; en plata 5.000. Más lote implica mayor exposición.",
              apalancamiento:
                "El apalancamiento permite operar con más dinero del que realmente tienes. Cuanto mayor el apalancamiento, menor el margen requerido, pero mayor el riesgo. El margen es capital inmovilizado durante la operación.",
            },
          };
        },
        methods: {
          setAyuda(id) {
            this.ayudaActiva = id;
          },
          showNotification(type, title, message, duration = 5000) {
            this.notification = { type, title, message };
            setTimeout(() => {
              this.notification = null;
            }, duration);
          },
          getPipSize() {
            if (!this.pair) return "0.0001";
            return Math.pow(10, -this.pipTable[this.pair].decimales).toString();
          },
          validateInputs() {
            if (!this.pair) {
              this.showNotification(
                "error",
                "Campo requerido",
                "Por favor, selecciona un par de divisas."
              );
              return false;
            }
            if (!this.precioEntrada || this.precioEntrada <= 0) {
              this.showNotification(
                "error",
                "Precio inválido",
                "El precio de entrada debe ser mayor que 0."
              );
              return false;
            }
            if (!this.precioSalida || this.precioSalida <= 0) {
              this.showNotification(
                "error",
                "Precio inválido",
                "El precio de salida debe ser mayor que 0."
              );
              return false;
            }
            if (!this.lote || this.lote <= 0) {
              this.showNotification(
                "error",
                "Lote inválido",
                "El tamaño del lote debe ser mayor que 0."
              );
              return false;
            }
            if (!this.apalancamiento || this.apalancamiento <= 1) {
              this.showNotification(
                "error",
                "Apalancamiento inválido",
                "El apalancamiento debe ser mayor que 1."
              );
              return false;
            }

            const rango = this.rangosPrecio[this.pair];
            if (
              this.precioEntrada < rango.min ||
              this.precioEntrada > rango.max
            ) {
              this.showNotification(
                "warning",
                "Precio fuera de rango",
                `El precio de entrada para ${this.pair} debe estar entre ${rango.min} y ${rango.max}`
              );
              return false;
            }
            if (
              this.precioSalida < rango.min ||
              this.precioSalida > rango.max
            ) {
              this.showNotification(
                "warning",
                "Precio fuera de rango",
                `El precio de salida para ${this.pair} debe estar entre ${rango.min} y ${rango.max}`
              );
              return false;
            }

            return true;
          },
          handleClick() {
            if (!this.validateInputs()) return;

            const info = this.pipTable[this.pair];
            const diff = this.precioSalida - this.precioEntrada;
            const signo = this.tipoOperacion === "compra" ? 1 : -1;
            const pipSize = Math.pow(10, -info.decimales);
            const deltaPips = signo * (diff / pipSize);
            const ganancia = deltaPips * info.valorPip * this.lote;
            const margen =
              (info.unidades * this.lote * this.precioEntrada) /
              this.apalancamiento;
            const rentabilidad = (ganancia / margen) * 100;

            this.resultado = {
              diferenciaPips: deltaPips,
              ganancia,
              margen,
              rentabilidad,
            };

            // Mostrar notificación de éxito
            const tipoNotificacion = ganancia >= 0 ? "success" : "warning";
            const mensaje =
              ganancia >= 0
                ? "La operación habría resultado en ganancia."
                : "La operación habría resultado en pérdida.";
            this.showNotification(
              tipoNotificacion,
              "Cálculo completado",
              mensaje
            );
          },
        },
        mounted() {
          lucide.createIcons();
        },
      }).mount("#app");
    </script>
  </body>
</html>
