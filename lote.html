<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de lote en trading</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center px-4 py-8">
  <div id="app" class="bg-white shadow-md rounded p-6 max-w-7xl w-full grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Columna principal -->
    <div class="md:col-span-2">
      <h1 class="text-2xl font-bold mb-6 text-center">Calculadora de lote en trading</h1>

      <div class="mb-6 relative">
        <label class="block font-semibold mb-1">Par de divisas o activo</label>
        <div class="relative">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">
            <i data-lucide="globe" class="w-4 h-4"></i>
          </span>
          <select v-model="pair" @focus="setAyuda('pair')" @change="setAyuda('pair')" class="w-full pl-10 border border-gray-300 rounded p-2">
            <option disabled value="">-- Selecciona un par --</option>
            <option v-for="(pip, key) in pipTable" :key="key" :value="key">{{ key }}</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="relative">
          <label class="block font-semibold mb-1">Tamaño de cuenta (USD)</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="wallet" class="w-4 h-4"></i>
          </span>
          <input v-model.number="accountSize" @focus="setAyuda('accountSize')" type="number" step="1"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>

        <div class="relative">
          <label class="block font-semibold mb-1">Riesgo por operación (%)</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="percent" class="w-4 h-4"></i>
          </span>
          <input v-model.number="riskPercent" @focus="setAyuda('riskPercent')" type="number" step="0.01"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>

        <div class="relative">
          <label class="block font-semibold mb-1">Stop loss (pips)</label>
          <span class="absolute left-3 top-10 text-gray-500">
            <i data-lucide="slash" class="w-4 h-4"></i>
          </span>
          <input v-model.number="stopLossPips" @focus="setAyuda('stopLossPips')" type="number" step="0.1"
            class="w-full text-right pl-10 border border-gray-300 rounded p-2">
        </div>
      </div>

      <div class="text-center mb-6">
        <button @click="handleClick"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 inline-flex items-center gap-2">
          <i data-lucide="calculator" class="w-4 h-4"></i>
          Calcular lote
        </button>
      </div>

      <div v-if="lotSize !== null" class="text-center mb-6">
        <p class="text-lg font-semibold">Tamaño de lote sugerido:</p>
        <p class="text-2xl text-green-600 font-bold">{{ lotSize.toFixed(2) }}</p>
      </div>

      <div class="mb-4">
        <h2 class="text-lg font-bold mb-2">Tabla de valores pip por lote</h2>
        <table class="w-full text-sm border border-gray-300" @mouseover="setAyuda('pipTable')">
          <thead class="bg-gray-200 text-gray-800">
            <tr>
              <th class="p-2 text-left">Par</th>
              <th class="p-2 text-left">Valor pip por lote estándar (USD)</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(pip, key) in pipTable" :key="key"
              :class="{'bg-blue-100 text-blue-800 font-semibold': pair === key}">
              <td class="p-2">{{ key }}</td>
              <td class="p-2">${{ pip.toFixed(2) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Caja de ayuda -->
    <div class="bg-gray-100 border border-gray-300 p-4 rounded text-sm leading-relaxed">
      <h2 class="font-bold text-lg mb-2">Ayuda contextual</h2>
      <p v-if="ayudaActiva">{{ ayudas[ayudaActiva] }}</p>
      <p v-else class="text-gray-500">Pasa el cursor o enfoca un campo para ver la explicación.</p>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          pair: '',
          accountSize: null,
          riskPercent: null,
          stopLossPips: null,
          lotSize: null,
          ayudaActiva: '',
          pipTable: {
            EURUSD: 10,
            GBPUSD: 10,
            USDJPY: 9.13,
            GBPJPY: 9.13,
            AUDUSD: 10,
            NZDUSD: 10,
            USDCHF: 10,
            USDCAD: 10,
            XAUUSD: 1,
            XAGUSD: 5,
            XAUEUR: 1,
            XAGEUR: 5
          },
          ayudas: {
            pair: 'En trading, un par de divisas representa la relación entre dos monedas: una que se compra y otra que se vende. Por ejemplo, en EUR/USD, compras euros vendiendo dólares. Cada par tiene características propias: los pares principales suelen tener spreads más bajos y mayor liquidez, mientras que los cruzados o los que involucran metales pueden ser más volátiles. Además, el valor de cada pip varía según el par. Esta elección no solo afecta el riesgo, sino también la velocidad y el comportamiento de la operación.',
            accountSize: 'El tamaño de la cuenta es el capital total disponible en tu bróker para operar. No es simplemente un número: representa tu capacidad de asumir pérdidas y de sostener tu operativa en el tiempo. Una cuenta más grande permite distribuir mejor el riesgo y sobrevivir a rachas negativas. Aquí, este valor es la base para calcular cuánto dinero estás dispuesto a arriesgar en cada operación según tu porcentaje de riesgo.',
            riskPercent: 'Este es uno de los pilares de la gestión monetaria. Indica qué fracción de tu cuenta estás dispuesto a perder si la operación sale mal. Un trader profesional rara vez arriesga más del 1-2% por operación. Arriesgar más puede acelerar las pérdidas en una mala racha y llevar a un colapso emocional. Definir correctamente este porcentaje es clave para la sostenibilidad y longevidad en el trading.',
            stopLossPips: 'El “stop loss” define el punto donde asumes que tu hipótesis era incorrecta. Medido en pips, representa la distancia entre tu punto de entrada y tu nivel de protección. No es un número arbitrario: debe estar basado en el análisis técnico y considerar la volatilidad del par. Cuanto más grande sea el stop, más lote necesitas reducir para mantener el riesgo fijo. Es una herramienta para controlar pérdidas, no una barrera emocional.',
            pipTable: 'El pip (Percentage in Point) es la unidad mínima de movimiento de precio en un par. El valor monetario del pip depende del par y del tamaño del lote. Por ejemplo, en EUR/USD 1 pip = $10 por lote estándar. Pero en XAU/USD o USD/JPY ese valor cambia. Conocer el valor del pip es fundamental para medir tu exposición real y ajustar el tamaño del lote para mantener el riesgo bajo control. La tabla te da valores aproximados usados por la mayoría de brókers.',
            result: 'El tamaño del lote es la cantidad de unidades de un par que vas a comprar o vender. No es una cifra arbitraria: se calcula con base en tu riesgo, tu capital y tu stop. Un lote estándar son 100.000 unidades; un micro lote, 1.000. Este cálculo convierte tu análisis en una decisión cuantitativa. Ignorar esta relación es operar a ciegas. Aquí obtienes el tamaño exacto para que tu riesgo esté controlado.'
          }
        };
      },
      methods: {
        setAyuda(id) {
          this.ayudaActiva = id;
        },
        calculateLot() {
          if (
            this.pair &&
            this.accountSize > 0 &&
            this.riskPercent > 0 &&
            this.stopLossPips > 0
          ) {
            const pipValue = this.pipTable[this.pair];
            const riskAmount = this.accountSize * (this.riskPercent / 100);
            this.lotSize = riskAmount / (this.stopLossPips * pipValue);
          } else {
            this.lotSize = null;
            alert('Completa todos los campos y selecciona un par.');
          }
        },
        handleClick() {
          this.calculateLot();
          this.setAyuda('result');
        }
      },
      mounted() {
        lucide.createIcons();
      },
      updated() {
        lucide.createIcons();
      }
    }).mount('#app');
  </script>
</body>
</html>
